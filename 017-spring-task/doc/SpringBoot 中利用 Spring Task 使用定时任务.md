# SpringBoot 中利用 Spring Task 使用定时任务

一个企业级应用中或多或少都会使用定时任务（也称任务调度）的需求。比如，每天凌晨 3 点执行一次定时任务，删除系统中超过 60 天还未激活的用户。又或者，用户在图形化界面中手动开启一个 3 小时后需要执行的任务。**按照使用角度划分，可以分为两类：**

- 按照指定的频率执行任务（比如，每个 3 天执行执行一次任务）（周期性任务）
- 按照指定的时间点执行任务（比如，12 小时候执行任务）（基于日历的单次任务）

## 定时任务的几种解决方案

定时任务本身涉及多线程、运行时间规则制定及解析、运行线程保持与恢复（程序突然停止了，就需要持久化定时任务的存储）、线程池维护等多方便的工作。如果直接使用自定义线程这种原始方法，实现起来的难度会很大，而且程序的稳定性也不好。实际上 Java 领域提供了很多任务调度的解决方案（尽管它们底层也是直接使用的自定义线程的方式，但是它们内部做了很多其他的工作，使得这个任务调度的程序变得很可靠）供用户使用。

- Timer/TimerTask
  - 这是 Java1.3 版本增加的用于实现定时任务的工具类，它只能够按照指定的频率执行任务，而不能够在指定的时间执行任务。
  - 功能单一，实际工作中有更好的替代方式，所以，没有必要去了解它哦。
- Executor
  - 这是 Java5.0 juc 包中新增的线程池相关的工具类，两种类型的定时任务都支持。
  - **如果项目确定是一个单体应用，且不需要大量使用到定时任务，那么非常推荐使用它。**
  - 基于日历的单次任务，直接使用它即可。对于周期性定时任务最好是直接使用 Spring Task （对 Java5.0 Executor 的一个封装）。
- Spring Task
  - 这是 Spring3.0 之后对于定时任务的一个基础性封装，它内部封装了 Timer、Executor 等。
  - 它内部有一个 ThreadPoolTaskExecutor 类，是对于 java.util.concurrent.ThreadPoolExecutor 类的一个封装。对外暴露了一个属性，供开发人员进行配置。
  - **对于单体应用中的固定频率的定时任务，推荐使用它。**
- Quartz
  - 这是一个专业的任务调度框架，能够使用数据库做持久化，同时还能够支持分布式集群（但是使用起来麻烦）。
  - **如果是单体应用，且有大量的定时任务需要使用，推荐使用它。**
- XXL-JOB
  - 这是一个专业的分布式任务调度框架，早期是基于 Quartz 实现的，后期改为自己实现的定时任务引擎。
  - **如果是分布式应用，且有大量的定时任务需要使用，那么推荐使用它。（使用广泛、简单、社区活跃度高）**
- Elastic-Job
  - 这同样是一个分布式任务调度框架，但是和 XXL-JOB 相比，稍显复杂把，社区活跃度也不行。了解有这个东西即可！